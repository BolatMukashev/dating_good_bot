# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Webhook –¥–ª—è Telegram –±–æ—Ç–∞

## üöÄ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

1. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ webhook** - –±–æ—Ç —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –≤ —Ä–µ–∂–∏–º–µ polling (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏), —Ç–∞–∫ –∏ –≤ —Ä–µ–∂–∏–º–µ webhook (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
2. **–ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** –Ω–∞ –æ—Å–Ω–æ–≤–µ aiohttp –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook –∑–∞–ø—Ä–æ—Å–æ–≤
3. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –≥–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üìã –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
BOT_API_KEY=your_bot_token_here
WEBHOOK_BASE_URL=https://yourdomain.com
DATABASE_URL=postgresql+asyncpg://user:password@host:port/database

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
BOT_MODE=webhook  # –∏–ª–∏ 'polling' –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
WEBHOOK_SECRET=your_secret_key
PORT=8000
```

## üõ† –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ù–∞ Heroku:

1. **–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Heroku**
2. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
3. **–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –≤ Settings ‚Üí Config Vars:
   - `BOT_API_KEY`
   - `WEBHOOK_BASE_URL` (https://your-app-name.herokuapp.com)
   - `DATABASE_URL` (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è Heroku Postgres)
   - `BOT_MODE=webhook`

4. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `Procfile`:**
   ```
   web: python main.py
   ```

### –ù–∞ Railway:

1. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
2. **–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
   - `BOT_API_KEY`
   - `WEBHOOK_BASE_URL` (https://your-project.railway.app)
   - `DATABASE_URL`
   - `BOT_MODE=webhook`

### –ù–∞ VPS (Ubuntu/Debian):

```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone your-repo-url
cd your-project

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º .env —Ñ–∞–π–ª
cp .env.example .env
nano .env

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å –ø–æ–º–æ—â—å—é systemd –∏–ª–∏ supervisor
python main.py
```

### Docker —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:

```dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .

EXPOSE 8000

CMD ["python", "main.py"]
```

## üîß –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ polling —Ä–µ–∂–∏–º:

```bash
# –í .env —Ñ–∞–π–ª–µ
BOT_MODE=polling

# –ò–ª–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
BOT_MODE=polling python main.py
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS** - Telegram —Ç—Ä–µ–±—É–µ—Ç HTTPS –¥–ª—è webhook
2. **–î–æ–±–∞–≤—å—Ç–µ webhook secret** –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø** –∫ webhook endpoint –Ω–∞ —É—Ä–æ–≤–Ω–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞

## ‚ö° Endpoints

- `GET /health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –±–æ—Ç–∞
- `POST /bot/{token}` - webhook endpoint –¥–ª—è Telegram
- `GET /` - –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞

## üêõ –û—Ç–ª–∞–¥–∫–∞

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** - –≤—Å–µ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook status**:
   ```python
   webhook_info = await bot.get_webhook_info()
   print(webhook_info)
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å URL** —á–µ—Ä–µ–∑ curl:
   ```bash
   curl https://yourdomain.com/health
   ```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
- **Health checks** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫** (–Ω–∞–ø—Ä–∏–º–µ—Ä, Sentry)
- **–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**

## üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏

### –ò–∑ Polling –≤ Webhook:
```bash
BOT_MODE=webhook python main.py
```

### –ò–∑ Webhook –≤ Polling:
```bash
BOT_MODE=polling python main.py
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫

- [ ] ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [ ] ‚úÖ WEBHOOK_BASE_URL —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω—ã–π HTTPS –¥–æ–º–µ–Ω
- [ ] ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–∞
- [ ] ‚úÖ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] ‚úÖ Webhook URL –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã
- [ ] ‚úÖ –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ webhook

## üÜò –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **"Webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å URL —á–µ—Ä–µ–∑ curl
2. **"Connection timeout"** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∞–π–µ—Ä–≤–æ–ª–∞
3. **"Invalid webhook"** - —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ HTTPS
4. **"Database connection error"** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ DATABASE_URL